import{_ as r}from"./chunks/ArticleMetadata.9c9d6287.js";import{_ as i,c as d,g as y,w as m,b as p,f as u,a as C,i as h,o as l,e as B,v as A}from"./app.e15dace8.js";const D="/assets/202211042020211.5951b90c.png",w=JSON.parse('{"title":"\u89E3\u51B3 Docker \u5B89\u88C5 Prometheus \u542F\u52A8\u62A5 permission denied \u7684\u95EE\u9898","description":"","frontmatter":{"title":"\u89E3\u51B3 Docker \u5B89\u88C5 Prometheus \u542F\u52A8\u62A5 permission denied \u7684\u95EE\u9898","author":"\u67E5\u5C14\u65AF","date":"2022/11/04 20:30","categories":["Bug\u4E07\u8C61\u96C6"],"tags":["Prometheus","Docker","Linux"]},"headers":[{"level":2,"title":"\u95EE\u9898\u63CF\u8FF0","slug":"\u95EE\u9898\u63CF\u8FF0","link":"#\u95EE\u9898\u63CF\u8FF0","children":[]},{"level":2,"title":"\u539F\u56E0\u5206\u6790","slug":"\u539F\u56E0\u5206\u6790","link":"#\u539F\u56E0\u5206\u6790","children":[]},{"level":2,"title":"\u89E3\u51B3\u65B9\u6848","slug":"\u89E3\u51B3\u65B9\u6848","link":"#\u89E3\u51B3\u65B9\u6848","children":[]}],"relativePath":"categories/issues/2022/11/04/\u89E3\u51B3Docker\u5B89\u88C5Prometheus\u542F\u52A8\u62A5\u9519\u7684\u95EE\u9898.md","lastUpdated":1668350473000}'),F={name:"categories/issues/2022/11/04/\u89E3\u51B3Docker\u5B89\u88C5Prometheus\u542F\u52A8\u62A5\u9519\u7684\u95EE\u9898.md"},g=p("h1",{id:"\u89E3\u51B3-docker-\u5B89\u88C5-prometheus-\u542F\u52A8\u62A5-permission-denied-\u7684\u95EE\u9898",tabindex:"-1"},[u("\u89E3\u51B3 Docker \u5B89\u88C5 Prometheus \u542F\u52A8\u62A5 permission denied \u7684\u95EE\u9898 "),p("a",{class:"header-anchor",href:"#\u89E3\u51B3-docker-\u5B89\u88C5-prometheus-\u542F\u52A8\u62A5-permission-denied-\u7684\u95EE\u9898","aria-hidden":"true"},"#")],-1),k=C(`<h2 id="\u95EE\u9898\u63CF\u8FF0" tabindex="-1">\u95EE\u9898\u63CF\u8FF0 <a class="header-anchor" href="#\u95EE\u9898\u63CF\u8FF0" aria-hidden="true">#</a></h2><p><strong>C\uFF1A</strong> \u4ECA\u5929\uFF0C\u7B14\u8005\u5728\u4F7F\u7528 Docker \u5B89\u88C5\u4E86 Prometheus \u540E\uFF0C\u53D1\u73B0\u5176\u5BB9\u5668\u6CA1\u6709\u80FD\u6B63\u5E38\u542F\u52A8\uFF0C\u800C\u662F\u5904\u4E8E\u6301\u7EED\u91CD\u542F\u7684\u72B6\u6001\u3002\u7B14\u8005\u624B\u52A8\u5C1D\u8BD5\u4E86\u51E0\u6B21\u91CD\u542F\u5BB9\u5668\u547D\u4EE4\uFF0C\u4F9D\u7136\u5982\u6B64\u3002</p><p>\u9047\u5230\u8FD9\u79CD\u60C5\u51B5\uFF0C\u5355\u7EAF\u53BB\u76EF\u5BB9\u5668\u8FD0\u884C\u547D\u4EE4\u54EA\u91CC\u6709\u9519\u8BEF\uFF0C\u6392\u67E5\u548C\u4FEE\u590D\u5C31\u6162\u4E86\uFF0C\u4E0D\u5982\u5148\u770B\u770B Prometheus \u5BB9\u5668\u7684\u65E5\u5FD7\u3002</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#7F848E;"># docker logs \u5BB9\u5668ID/\u5BB9\u5668\u540D\u79F0</span></span>
<span class="line"><span style="color:#ABB2BF;">docker logs prometheus</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#676E95;"># docker logs \u5BB9\u5668ID/\u5BB9\u5668\u540D\u79F0</span></span>
<span class="line"><span style="color:#A6ACCD;">docker logs prometheus</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u5BB9\u5668\u65E5\u5FD7\u4E2D\uFF0C\u7B14\u8005\u770B\u5230\u4E86\u51E0\u6BB5\u91CD\u590D\u6027\u7684\u65E5\u5FD7\u5185\u5BB9\uFF0C\u5F88\u663E\u7136\u8FD9\u662F\u51E0\u6B21\u91CD\u542F\u5BB9\u5668\u51FA\u73B0\u7684\u91CD\u590D\u6027\u65E5\u5FD7\uFF0C\u7B14\u8005\u4ECE\u4E2D\u622A\u53D6\u4E86\u4E00\u6BB5\u76F8\u5BF9\u5B8C\u6574\u7684\u65E5\u5FD7\u5185\u5BB9\u3002</p><p><img src="`+D+`" alt="202211042020211"></p><p>\u9519\u8BEF\u4FE1\u606F\u90E8\u5206\u4E5F\u5F88\u7A81\u51FA\uFF0Clevel=error\u3002</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">caller=query_logger.go:90 level=error component=activeQueryTracker msg=</span><span style="color:#98C379;">&quot;Error opening quer log file&quot;</span><span style="color:#ABB2BF;"> file=/opt/bitnami/prometheus/data/queries.active err=</span><span style="color:#98C379;">&quot;open data/queries.active: permission denied&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">panic: Unable to create mmap-ed active query log</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">caller=query_logger.go:90 level=error component=activeQueryTracker msg=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Error opening quer log file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> file=/opt/bitnami/prometheus/data/queries.active err=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">open data/queries.active: permission denied</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">panic: Unable to create mmap-ed active query log</span></span>
<span class="line"></span></code></pre></div><h2 id="\u539F\u56E0\u5206\u6790" tabindex="-1">\u539F\u56E0\u5206\u6790 <a class="header-anchor" href="#\u539F\u56E0\u5206\u6790" aria-hidden="true">#</a></h2><p>\u7B80\u5355\u7FFB\u8BD1\u4E00\u4E0B\u9519\u8BEF\u4FE1\u606F msg \u53CA\u540E\u9762\u90E8\u5206\u63D0\u793A\u3002</p><blockquote><p>\u4FE1\u606F\uFF1A\u6253\u5F00\u67E5\u8BE2\u65E5\u5FD7\u6587\u4EF6\u65F6\u51FA\u9519 file=/opt/bitnami/prometheus/data/queries.active \u9519\u8BEF\uFF1A\u6253\u5F00 data/queries.active\uFF1A\u62D2\u7EDD\u8BBF\u95EE</p></blockquote><p>\u5176\u4E2D\u7684\u5173\u952E\u4FE1\u606F\u662F <code>permission denied</code>\uFF08\u62D2\u7EDD\u8BBF\u95EE\uFF09\uFF0C\u4ECE\u8FD9\u5B57\u9762\u610F\u601D\u4E0A\u53EF\u4EE5\u5F97\u77E5\u548C\u6743\u9650\u6709\u5173\u3002</p><p>\u4E3A\u4E86\u65B9\u4FBF\u5927\u5BB6\u8FDB\u884C\u539F\u56E0\u5206\u6790\uFF0C\u7B14\u8005\u628A docker-compose \u7684 Prometheus \u90E8\u5206\u811A\u672C\u8D34\u5728\u4E0B\u65B9\u3002</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3&#39;</span></span>
<span class="line"><span style="color:#E06C75;">services</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">prometheus</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">container_name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">prometheus</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">bitnami/prometheus:2.38.0</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">restart</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">always</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">environment</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">TZ</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Asia/Shanghai</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">ports</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">19090:9090</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">volumes</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">/opt/disk/docker/volumes/prometheus/conf:/opt/bitnami/prometheus/conf</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">/opt/disk/docker/volumes/prometheus/data:/opt/bitnami/prometheus/data</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">command</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">--config.file=/opt/bitnami/prometheus/conf/prometheus.yml</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">--web.enable-lifecycle</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">--storage.tsdb.retention.time=90d</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">privileged</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">prometheus</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">container_name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">prometheus</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bitnami/prometheus:2.38.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">restart</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">always</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">TZ</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Asia/Shanghai</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">19090:9090</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/opt/disk/docker/volumes/prometheus/conf:/opt/bitnami/prometheus/conf</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/opt/disk/docker/volumes/prometheus/data:/opt/bitnami/prometheus/data</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">--config.file=/opt/bitnami/prometheus/conf/prometheus.yml</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">--web.enable-lifecycle</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">--storage.tsdb.retention.time=90d</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">privileged</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"></span></code></pre></div><p>\u5F88\u660E\u663E\uFF0C\u9519\u8BEF\u4FE1\u606F\u4E2D\u7684\u6587\u4EF6\u8DEF\u5F84 <code>/opt/bitnami/prometheus/data/queries.active</code>\uFF0C\u662F Prometheus \u5BB9\u5668\u4E2D\u7684\u6570\u636E\u5B58\u50A8\u76EE\u5F55\uFF0C\u7B14\u8005\u8FD8\u5C06\u5176\u6302\u8F7D\u5230\u4E86\u5BBF\u4E3B\u673A\u7684 <code>/opt/disk/docker/volumes/prometheus/data</code> \u76EE\u5F55\u3002</p><p>\u5173\u4E8E\u811A\u672C\u4E2D\u7684\u4E24\u4E2A\u6302\u8F7D\u76EE\u5F55\uFF0C\u7B14\u8005\u4EC5\u63D0\u524D\u521B\u5EFA\u4E86 conf \u914D\u7F6E\u76EE\u5F55\uFF0C\u4E0A\u4F20\u4E86\u914D\u7F6E\u6587\u4EF6\u3002\u81F3\u4E8E\u8FD9\u4E2A data \u6570\u636E\u76EE\u5F55\u5219\u662F Docker \u5728\u8FD0\u884C\u5BB9\u5668\u65F6\u81EA\u52A8\u5728\u5BBF\u4E3B\u673A\u521B\u5EFA\u7684\u3002</p><p>\u90A3\u95EE\u9898\u7684\u539F\u56E0\u5DF2\u7ECF\u547C\u4E4B\u6B32\u51FA\u4E86\uFF0C\u5F88\u5927\u53EF\u80FD\u662F\u7531\u4E8E Docker \u5728\u5BBF\u4E3B\u673A\u81EA\u52A8\u521B\u5EFA\u7684 data \u6570\u636E\u6302\u8F7D\u76EE\u5F55\u6CA1\u6709\u5199\u5165\u6743\u9650\u3002</p><h2 id="\u89E3\u51B3\u65B9\u6848" tabindex="-1">\u89E3\u51B3\u65B9\u6848 <a class="header-anchor" href="#\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a></h2><p>\u89E3\u51B3\u8D77\u6765\u4E5F\u8F83\u4E3A\u5BB9\u6613\uFF0C\u7ED9 data \u76EE\u5F55\u6388\u4E88\u5199\u5165\u6743\u9650\u5C31\u597D\u4E86\u3002</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">chmod 775 /opt/disk/docker/volumes/prometheus/data</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">chmod 775 /opt/disk/docker/volumes/prometheus/data</span></span>
<span class="line"></span></code></pre></div><p>\u6700\u540E\u518D\u91CD\u542F\u4E00\u4E0B Prometheus \u5BB9\u5668\u3002</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">docker restart prometheus</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">docker restart prometheus</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u65F6\uFF0C\u518D\u901A\u8FC7 <code>docker ps</code> \u547D\u4EE4\u67E5\u770B Prometheus \u5BB9\u5668\u7684\u72B6\u6001\uFF0C\u5DF2\u7ECF\u662F\u6B63\u5E38\u7684 Up \u72B6\u6001\u4E86\u3002\u6700\u540E\uFF0C\u7B14\u8005\u4E5F\u662F\u5EFA\u8BAE\u5927\u5BB6\u8FD9\u7C7B\u6302\u8F7D\u76EE\u5F55\u5C3D\u91CF\u63D0\u524D\u521B\u5EFA\u548C\u6388\u6743\u3002</p>`,23);function v(s,_,b,f,E,q){const t=r,c=h("ClientOnly");return l(),d("div",null,[g,y(c,null,{default:m(()=>{var a,n,e,o;return[((n=(a=s.$frontmatter)==null?void 0:a.aside)!=null?n:!0)&&((o=(e=s.$frontmatter)==null?void 0:e.showArticleMetadata)!=null?o:!0)?(l(),B(t,{key:0,article:s.$frontmatter},null,8,["article"])):A("",!0)]}),_:1}),k])}const x=i(F,[["render",v]]);export{w as __pageData,x as default};
